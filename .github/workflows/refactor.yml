name: "üõ°Ô∏è Safe Refactor & Cleanup"

on:
  workflow_dispatch: # –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é –∫–Ω–æ–ø–∫–æ–π

permissions:
  contents: write
  pull-requests: write

jobs:
  refactor:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install Dependencies
        run: |
          pip install black isort pytest pytest-asyncio
          # –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å requirements.txt, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ:
          # pip install -r requirements.txt

      - name: üß™ Run Tests (Pre-check)
        run: |
          # –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã —É–ø–∞–¥—É—Ç —Ç—É—Ç - –∑–Ω–∞—á–∏—Ç –∫–æ–¥ –±—ã–ª —Å–ª–æ–º–∞–Ω –µ—â–µ –î–û —á–∏—Å—Ç–∫–∏
          # –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É tests –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç, —á—Ç–æ–±—ã pytest –Ω–µ —Ä—É–≥–∞–ª—Å—è
          mkdir -path tests
          pytest || echo "‚ö†Ô∏è Warning: Initial tests failed or no tests found"

      - name: üßπ Import Sort (Isort)
        run: isort .

      - name: üé® Code Format (Black)
        run: black .

      - name: üóëÔ∏è Remove Comments
        run: |
          # –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç —á–∏—Å—Ç–∫–∏
          python .github/scripts/clean_code.py

      - name: üé® Code Format Again (Black)
        run: |
          # –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–æ–≤ –º–æ–≥—É—Ç –æ—Å—Ç–∞—Ç—å—Å—è –ª–∏—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã, black —ç—Ç–æ –ø–æ–ø—Ä–∞–≤–∏—Ç
          black .

      - name: üß™ Run Tests (Post-check)
        run: |
          # –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã —É–ø–∞–¥—É—Ç —Ç—É—Ç - –∑–Ω–∞—á–∏—Ç —á–∏—Å—Ç–∫–∞ —Å–ª–æ–º–∞–ª–∞ –ª–æ–≥–∏–∫—É
          pytest

      - name: üì® Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Refactor: remove comments, format code"
          title: "ü§ñ Auto-Refactor: Cleanup & Format"
          body: |
            This PR was automatically created by GitHub Actions.
            
            **Changes:**
            - üßπ Removed comments and docstrings
            - üé® Formatted code with `black`
            - üìã Sorted imports with `isort`
            - ‚úÖ Verified with `pytest`
            
            **Instruction:**
            Please review the changes carefully before merging!
          branch: "refactor/auto-cleanup"
          delete-branch: true
          base: "feature/1.15.3" # –£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É, –∫—É–¥–∞ –≤–ª–∏–≤–∞—Ç—å